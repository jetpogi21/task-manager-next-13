//Generated by WriteToModeltable_tsx - ModelTable.tsx for Table 9/18
"use client";
import React, { useEffect } from "react";
import { useTaskStore } from "@/hooks/tasks/useTaskStore";
import TaskDataTable from "@/components/tasks/TaskDataTable";
import { TaskModel, TaskSearchParams } from "@/interfaces/TaskInterfaces";
import { useQueryClient } from "@tanstack/react-query";
import { useModelsQuery } from "@/hooks/useModelQuery";
import { TaskConfig } from "@/utils/config/TaskConfig";
import { GetModelsResponse } from "@/interfaces/GeneralInterfaces";
import { useModelPageParams } from "@/hooks/useModelPageParams";
import { getCurrentData } from "@/lib/getCurrentData";
import { getRefetchQueryFunction } from "@/lib/refetchQuery";

const TaskTable: React.FC = () => {
  const config = TaskConfig;
  const { params } = useModelPageParams<TaskSearchParams>(config);
  const queryClient = useQueryClient();

  const [mounted, setMounted] = React.useState(false);

  //Store Variables
  const page = useTaskStore((state) => state.page);
  const setRecordCount = useTaskStore((state) => state.setRecordCount);
  const fetchCount = useTaskStore((state) => state.fetchCount);
  const setFetchCount = useTaskStore((state) => state.setFetchCount);
  const previousData = useTaskStore((state) => state.currentData);
  const setCurrentData = useTaskStore((state) => state.setCurrentData);
  const setQueryResponse = useTaskStore((state) => state.setQueryResponse);
  const setRefetchQuery = useTaskStore((state) => state.setRefetchQuery);

  const queryParams = params;

  const useTaskSearchQuery = () =>
    //@ts-ignore
    useModelsQuery<TaskModel>(config, {
      ...queryParams,
      fetchCount: fetchCount.toString(),
    });

  const queryResponse = useTaskSearchQuery();
  const { data, refetch, isFetching } = queryResponse;

  const currentPageData: GetModelsResponse<TaskModel> | null = data
    ? data.pages[page - (isFetching ? 2 : 1)]
    : null;
  const currentData: any[] = getCurrentData(
    currentPageData,
    previousData as any
  );

  //Client functions
  const refetchQuery = getRefetchQueryFunction(
    config,
    params,
    refetch,
    queryClient
  );

  useEffect(() => {
    setMounted(true);
    return () => {
      setMounted(false);
    };
  }, []);

  useEffect(() => {
    setQueryResponse(useTaskSearchQuery);
    if (currentPageData?.count !== undefined) {
      setRecordCount(currentPageData?.count || 0);
    }
    setFetchCount(!fetchCount);
    setCurrentData(currentData);
    setRefetchQuery(refetchQuery);
  }, [currentPageData?.count, data, page]);

  return mounted && <TaskDataTable taskQuery={useTaskSearchQuery} />;
};

export default TaskTable;
